# 设计说明

## 功能分析

### 用户充值
用户可以充值到自己的帐户余额，技术实现上考虑将余额的变动下放到底层服务。
同时将用户充值作为内部的一次支付，增加支付模块实现。

### 商家调整库存
商家可以添加商品SKU的库存，技术实现上考虑将库存的变动下放在底层服务。

### 用户购买商品
用户购买商品，生成订单和订单明细，同时扣减用户余额，增加商家收益。
同时将用户购买也作为内部的一次支付，增加支付模块实现，可以与用户充值复用支付的底层服务。

### 商家定时结算
每日为商家定时结算，并生成结算报告。

## 存储设计
使用MySQL关系数据库
见数据表设计

## 系统搭建
技术：Linux + Java17 + SpringBoot + MyBatis + MySQL
测试：JUnit5 + Mockoit + H2; 领域实体或聚合根单元测试，上层服务使用H2集成测试；
自动生成MyBatis Mapper等基础文件

## 代码架构
模块化 + 六边形架构 + 命令模式 + 分层

### 模块化（限界上下文）
分为买家、商户、商品、支付、订单、结算这几个模块；
模块内部按层次调用；
模块间走适配器调用；

### 六边形架构
每个（限界上下文）对外统一走适配器，目前规划了local调用是其他模块调用，rest是用户访问调用
模块（限界上下文）内部按层次调用；

### 命令模式
适配器（应用服务）的请求，读取请求直接到领域服务的具体方法，写入请求抽象成命令后调用领域服务方法；

### 分层
适配器（应用服务） -> 领域层 -> 资源层 -> 存储层

## 测试说明
聚合根使用单元测试
领域服务、适配器层使用带H2数据库的集成测试作为单元测试
真实请求使用curl请求

**备注**
部分测试用例可能存在依赖，建议是单个独立自行









